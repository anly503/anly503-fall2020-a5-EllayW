---
title: "index"
author: "Yueqi (Ella) Wang"
date: "10/23/2021"
output: 
  html_fragment
---



## Plot 2
The plot below is a density plot by `date` and `appliances` of house 4. Since from the first plot, we see house 4 consume more eletricities in millions than the other two households, we now zoom in and focus on house 4 with question 2. 

Question 2: "Which are the abnormal time period in house 4 based on their daily consumption?"

Different with the first plot, this one shows daily `consumption` by `appliances` with details. As a time-series data set, line plot and density plot are the most appropriate one to show the details daily.

Also, by clicking the legend, for example "Freezer" once, this category will be isolated, so we can subtract the abnormal / extreme category and explore others. The time slot at the bottom gives a time measure of the whole period. We can easily move forward / backward with it. 

We find out that from late Dec. 2012 to early Jan. 2013, house 4 had abnormal consumption, especially on 'Freezer'.


```{r eval=knitr::is_html_output(), echo=FALSE, message=FALSE, warning=FALSE}
library(plotly)
library(dplyr)


df <- read.csv('plot-data.csv')
df2 <- df%>%
  select(date, appliance, house,consumption) %>%
  group_by(date,appliance,house) %>%
  summarise(consumption = sum(consumption))
df2$consumption <- df2$consumption/1000000
df2 <- df2[df2$house == 4,]
df2$house = NULL


## change data type
df2$appliance <- factor(df2$appliance)
df2$date <- factor(df2$date)
df3 <- df2 %>% 
  group_by(date,appliance) %>%
  summarise(consumption = sum(consumption)) %>% 
  ungroup()

shared_data <- df3 %>% 
  highlight_key(~appliance)

## @knitr fig
fig <-shared_data  %>%
  plot_ly(., x = ~date, 
          y = ~consumption, type = 'scatter',mode = 'line',
          color = ~appliance, fill = 'tozeroy',
          text = ~consumption,
          hoverinfo = 'text',
          transforms = list(
            list(
              type = 'filter',
              target = ~appliance,
              operation = '=',
              value = unique(df2$appliance)[1]
            )
          ))


fig <- fig %>% layout(
  title = "Daily Consumption(M) by Appliances")

fig
```

```{r}
library(IRdisplay)
display_html('plotly.html')
```





